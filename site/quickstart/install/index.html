<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">   
    <link rel="shortcut icon" href="../../img/favicon.ico">

    <title>Installing Coral Ecosystem - Coral Project Docs</title>

    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../css/base.css" rel="stylesheet">
    <link href="../../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">


    <link href="../../css/extra.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
    <script>
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-73335347-3', 'docs.coralproject.net');
    ga('send', 'pageview');
    </script>
    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Coral Project Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../products/">Products</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developer Guide <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../developer/">Introduction</a>
</li>

                        
                            
<li >
    <a href="../../developer/architectural_overview/">Architectural overview</a>
</li>

                        
                            
<li class="active">
    <a href="./">Installing Coral Ecosystem</a>
</li>

                        
                            
<li >
    <a href="../../developer/developer_setup/">Developer tools setup</a>
</li>

                        
                            
<li >
    <a href="../../cay/">Cay</a>
</li>

                        
                            
<li >
    <a href="../../elkhorn/">Elkhorn</a>
</li>

                        
                            
<li >
    <a href="../../pillar/">Pillar</a>
</li>

                        
                            
<li >
    <a href="../../sponge/">Sponge</a>
</li>

                        
                            
<li >
    <a href="../../xenia/">Xenia</a>
</li>

                        
                            
<li >
    <a href="../../xenia/xenia-driver-js/">Xenia Driver</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../user/">Introduction</a>
</li>

                        
                            
<li >
    <a href="../../user/trust/">Trust</a>
</li>

                        
                            
<li >
    <a href="../../user/ask/">Ask</a>
</li>

                        
                            
<li >
    <a href="../../user/talk/">Talk</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contribute <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../contribute/">Introduction</a>
</li>

                        
                            
<li >
    <a href="../../contribute/writing_documentation/">Writing documentation</a>
</li>

                        
                            
<li >
    <a href="../../contribute/docs_style_guide/">Documentation style guide</a>
</li>

                        
                            
<li >
    <a href="../../contribute/writing_code/">Writing code</a>
</li>

                        
                            
<li >
    <a href="../../contribute/coding_style_guide/">Coding style guide</a>
</li>

                        
                            
<li >
    <a href="../../contribute/reporting_bugs/">Reporting bugs and requesting features</a>
</li>

                        
                            
<li >
    <a href="../../contribute/code_of_conduct/">Code of Conduct</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../faq/">FAQ</a>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../../developer/architectural_overview/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../../developer/developer_setup/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="first-level active"><a href="#all-in-one-docker-compose-installation">All-in-One Docker Compose Installation</a></li>
        
            <li class="second-level"><a href="#before-you-begin">Before you begin</a></li>
            
                <li class="third-level"><a href="#operating-system-requirements">Operating system requirements</a></li>
            
        
            <li class="second-level"><a href="#install-docker-toolbox">Install Docker Toolbox</a></li>
            
        
            <li class="second-level"><a href="#get-the-source-code">Get the source code</a></li>
            
        
            <li class="second-level"><a href="#set-environment-variables">Set environment variables</a></li>
            
        
            <li class="second-level"><a href="#spin-up-the-docker-container">Spin up the Docker container</a></li>
            
        
            <li class="second-level"><a href="#test-it-out">Test it out</a></li>
            
        
            <li class="second-level"><a href="#troubleshooting">Troubleshooting</a></li>
            
                <li class="third-level"><a href="#viewing-running-docker-containers">Viewing running Docker containers</a></li>
            
                <li class="third-level"><a href="#viewing-installed-docker-images">Viewing installed Docker images</a></li>
            
                <li class="third-level"><a href="#viewing-docker-logs">Viewing Docker logs</a></li>
            
        
            <li class="second-level"><a href="#removing-docker-images">Removing Docker images</a></li>
            
        
            <li class="second-level"><a href="#removing-old-docker-machines">Removing old Docker machines</a></li>
            
        
    
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="all-in-one-docker-compose-installation">All-in-One Docker Compose Installation</h1>
<p>The all-in-one Docker Compose installation is a quick, easy, packaged solution that requires few steps and should get all components up and running quickly. The downside is that this may not scale well, as everything is installed on one server. After a certain number of users (perhaps 50 or so), the server could become overloaded.</p>
<p>You can read about the different types of installation options on the <a href="../../developer">developer introduction page</a>.</p>
<h2 id="before-you-begin">Before you begin</h2>
<p>You must have the following items installed and running:</p>
<ul>
<li><strong>MongoDB Server</strong>: You can find instructions on installing MongoDB <a href="https://docs.mongodb.com/getting-started/shell/">on the MongoDB website</a>.</li>
<li><strong>RabbitMQ</strong>: You can find instructions on installing RabbitMQ <a href="https://www.rabbitmq.com/download.html">on the RabbitMQ website</a>.</li>
</ul>
<p>You should also have the following resources on your machine before installing:</p>
<ul>
<li>Minimum CPU: 2.0 GHz</li>
<li>Minimum RAM: 4GB</li>
<li>Minimum disk space required: 4GB</li>
</ul>
<h3 id="operating-system-requirements">Operating system requirements</h3>
<p>On Mac, we support OS X El Capitan (10.11) or newer. If you are on an older OS, you may have to upgrade.</p>
<h2 id="install-docker-toolbox">Install Docker Toolbox</h2>
<p>If you do not already have Docker installed, do that first. You can install Docker Toolbox from the <a href="https://www.docker.com/products/docker-toolbox">Docker Toolbox product page</a>.</p>
<p>If you do have Docker installed, you&rsquo;ll want to make sure that you have Docker Compose version 1.7 or later. You can check your version using the command <code>docker-compose version</code>.</p>
<ul>
<li>On the server, you can install Docker with the following command:</li>
</ul>
<pre><code>sudo yum install docker
</code></pre>

<h2 id="get-the-source-code">Get the source code</h2>
<p>Clone the Proxy repository. This repository contains a number of setup files that you can edit, and will help you easily spin up a Docker container.</p>
<pre><code>git clone https://github.com/coralproject/Proxy.git
</code></pre>

<p>Then cd into the Proxy directory.</p>
<pre><code>cd Proxy
</code></pre>

<h2 id="set-environment-variables">Set environment variables</h2>
<p>The <code>env.conf</code> file contains environment variables you need to set. Setting your environment variables tells Docker which IP address your Coral frontend will have, as well as other information such as your MongoDB username and password.</p>
<pre><code>export FRONTEND_HOST=

export GAID_VALUE=xxxx
export AUTH_TOKEN_VALUE=xxxx
export RABBIT_USER=rabbitmq
export RABBIT_PASS=welcome
# mongo:
export MONGO_AUTHDB=admin
export MONGO_USER=coral-user
export MONGO_PASS=welcome
export MONGO_DB=coral

#elkhorn
export accessKeyId=xxx
export secretAccessKey=xxx
export pillarHost=xxx
export basicAuthorization=xxx
export bucket=xxx
export region=xxx
# sponge:
export STRATEGY_CONF=/usr/local/strategy.json
</code></pre>

<p>Required edits:</p>
<ul>
<li><code>FRONTEND_HOST</code>: set to your desired IP address for the front end. For this example, we will use <code>192.168.99.100</code>, which is the default Docker machine IP for local machine installs.</li>
</ul>
<p>Optional edits:</p>
<ul>
<li><code>GAID_VALUE=xxxx</code>: If you&rsquo;re using Google Analytics, set your token at <code>export GAID_VALUE=xxxx</code>. Otherwise, delete or comment out this line.</li>
<li><code>export AUTH_TOKEN_VALUE=xxxx</code>: If you&rsquo;re using a custom auth token, set that at <code>export AUTH_TOKEN_VALUE=xxxx</code>. Otherwise, delete or comment out this line.</li>
</ul>
<p>Finally, while inside the <code>Proxy</code> directory, run the following command to export your edited variables and set the environment variables.</p>
<pre><code>source env.conf
</code></pre>

<h2 id="spin-up-the-docker-container">Spin up the Docker container</h2>
<p>The very first time that you spin up the Docker container, this will be a multi-step process:</p>
<p>1. Spin up the Docker container:</p>
<pre><code>docker-compose -f docker-compose.yml up -d
</code></pre>

<p>The <code>docker-compose.yml</code> file contained in the docker-setup directory contains all the instructions that Docker Compose needs to set up the Coral Ecosystem.</p>
<p>2. <strong>Note:</strong> If this is your first time spinning up the Docker container, Docker is going to download and install a number of Docker images first. These can be fairly large (~500MB per image), so it may take a few minutes.</p>
<p>3. Once all Docker images have been downloaded, you&rsquo;ll see something like the following in your terminal:</p>
<pre><code>Creating proxy_mongodata_1
Creating proxy_sponge_1
Creating proxy_rabbitmq_1
Creating proxy_atollapp_1
Creating proxy_xeniaapp_1
Creating proxy_pillarapp_1
Creating proxy_cayapp_1
Creating proxy_proxy_1
</code></pre>

<p><strong>Note</strong>: If this is your first time spinning up the Docker container, be aware that there is a large chunk of dummy data being downloaded as well. This happens behind the scenes, so it isn&rsquo;t as easy to tell whether or not it is done. You can check on its progress by looking at the logs.</p>
<p>First you have to find the container id for proxy_mongodata_1:</p>
<pre><code>docker ps
</code></pre>

<p>Then use the container id to view the logs:</p>
<pre><code>docker logs e0bbd7be19c7
</code></pre>

<p>If it has not finished downloading, you&rsquo;ll see this as the final line in the logs:</p>
<pre><code>Notice: doownloading dump from https://s3.amazonaws.com/coral-demo-dataset/dump.tar.gz
</code></pre>

<p>If it has finished downloading, you should see this among the final lines in the logs:</p>
<pre><code>2016-07-21T00:42:33.024+0000 I NETWORK  [HostnameCanonicalizationWorker] Starting hostname canonicalization worker
2016-07-21T00:42:33.025+0000 I FTDC     [initandlisten] Initializing full-time diagnostic data capture with directory '/data/db/diagnostic.data'
2016-07-21T00:42:33.031+0000 I NETWORK  [initandlisten] waiting for connections on port 27017
</code></pre>

<p>4. Now, shut everything down with the Docker <code>down</code> command. This up-down-up sequence initializes authentication on MongoDB.</p>
<pre><code>docker-compose -f docker-compose.yml down
</code></pre>

<p>5. Finally, start the Docker container back up. In future (now that the Docker images have all been downloaded and set up), you can simply use this command to start your Docker container.</p>
<pre><code>docker-compose -f docker-compose.yml up -d
</code></pre>

<h2 id="test-it-out">Test it out</h2>
<p>To make sure it&rsquo;s working, try to hit the front-end URL in your browser. This is the URL you specified as <code>FRONTEND_HOST</code> in the <code>env.conf</code> setup above; in this case, <a href="https://192.168.99.100">https://192.168.99.100</a>.</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="viewing-running-docker-containers">Viewing running Docker containers</h3>
<p>To see all of the Docker containers currently running, use the command <code>docker ps</code> (you can read more about this command and its options at the <a href="https://docs.docker.com/engine/reference/commandline/ps/">Docker website</a>).</p>
<pre><code>docker ps
</code></pre>

<p>You should have all of the following containers running:</p>
<ul>
<li>nginx:stable-alpine</li>
<li>coralproject/cay</li>
<li>coralproject/elkhorn</li>
<li>coralproject/pillar</li>
<li>coralproject/atoll</li>
<li>coralproject/xenia</li>
<li>coralproject/sponge</li>
<li>rabbitmq:management</li>
<li>coralproject/mongodata</li>
</ul>
<h3 id="viewing-installed-docker-images">Viewing installed Docker images</h3>
<p>To see all of the Docker images you have installed, use the command <code>docker images</code> (you can read more about this command and its options at the <a href="https://docs.docker.com/engine/reference/commandline/images/">Docker website</a>).</p>
<pre><code>docker images
</code></pre>

<h3 id="viewing-docker-logs">Viewing Docker logs</h3>
<p>To view Docker logs for a container, use the command <code>docker logs &lt;container id&gt;</code> (you can read more about this command and its options at the <a href="https://docs.docker.com/engine/reference/commandline/logs/">Docker website</a>).</p>
<p>First you have to find the container id:</p>
<pre><code>docker ps
</code></pre>

<p>Then use the container id to view the logs:</p>
<pre><code>docker logs e0bbd7be19c7
</code></pre>

<h2 id="removing-docker-images">Removing Docker images</h2>
<p>There are a few reasons you might want to remove Docker images. You may wish to ensure that you are getting the latest build of the image. Or maybe something has gone awry with one or more of the images, and you just want to perform a fresh install of all images.</p>
<p>To remove all Docker images, use this command:</p>
<pre><code>docker rmi $(docker images -q)
</code></pre>

<h2 id="removing-old-docker-machines">Removing old Docker machines</h2>
<p>Another option for a &ldquo;fresh install&rdquo; is to remove old Docker machines. You could try this in combination with <a href="#removing-docker-images">removing Docker images</a> and then reinstalling Ask to see if that fixes your issue.</p>
<pre><code>docker rm -f $(docker ps -a -q)
</code></pre></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
    </footer>

    <script src="../../js/jquery-1.10.2.min.js"></script>
    <script src="../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '../..';
    </script>
    <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
    <script src="../../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
